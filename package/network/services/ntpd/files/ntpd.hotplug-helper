#!/bin/sh

APP=/usr/sbin/ntpq

if [ ! -x $APP ]; then
	APP="/usr/local$APP"
fi

SLEEPTIME=10

while true
do
	STATUS="$($APP -c 'rv 0 stratum'|awk -F '=' '{ print $2 }')"

	if [[ -n "$STATUS" && "$STATUS" -lt "16" ]]
	then
		ACTION="stratum" /sbin/hotplug-call ntp
		SLEEPTIME=660
	fi
	sleep $SLEEPTIME
done
